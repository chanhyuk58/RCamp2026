---
title: "Day4 Problem Set Solutions"
author: "Cecilia Sui"
date: "1/13/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Day 4 Outline:
1. Descriptive Statistics
2. Introduction to `ggplot`
3. Simple linear regression


# Descriptive Statistics and Simple linear regression

This section touches on how to run linear regression briefly. Don't worry if you
do not understand the meaning of every item in your summary table for your
model. We will learn more about how to interpret them in QPM I and II.

1. Install and load the **faraway** package. Load the **gavote** dataset. Study
   the dataset using the help() function. Create a new variable called
   undercount by calculating the percentage of ballots that were not counted
   into votes. What’s the range and quantiles of this new variable? Draw a
   histogram to illustrate the distribution of this variable.  
```{r}
# install.packages("faraway")
library("faraway")
df <- gavote
df$undercount <- (df$ballots - df$votes) / df$ballots
quantile(df$undercount)
hist(df$undercount)
```
2. Create a new variable **perGore** for the percentage of votes for Gore. Use
   **plot(col1, col2)** to create a scatter plot for the columns: **perGore**
   and **perAA**. What do you see? How can you interpret the plot?
```{r}
df$perGore <- (df$gore / df$votes)
plot(df$perAA, df$perGore)
# Positive correlation between perAA and perGore
```


3. Let’s run a linear regression with undercount as the response and perAA as
   the predictor. (Please refer back to the lecture notes for the example we
   did.) Summarize the regression results and describe what you see. Can you get
   the coefficients? 
```{r}
lm_3 <- lm(undercount ~ df$perAA, data = df)
summary(lm_3)
```
4. Run a linear regression with undercount as the response variable and both
   perGore and perAA as predictors. Summarize the results and describe what has
   changed. Can you guess why we observe such change?
```{r}
lm_4 <- lm(undercount ~ perAA + perGore, data = df)
summary(lm_4)
```

5. Use one of the previous linear regression object. Run visual diagnosis using `plot()` function.
```{r}
plot(lm_3, which = 1)
plot(lm_3, which = 2)
plot(lm_3, which = 3)
plot(lm_3, which = 4)
plot(lm_3, which = 5)
plot(lm_3, which = 6)
```

# ggplot2 Basics 

1. Find all the variables that negatively correlates with TFR from the
   **worldTFR** dataset. Can you offer a reasoning of the relationships?
```{r, eval=FALSE}
tfr <- read.csv("/Users/river/Documents/GitHub/RCamp2023/Day5/Lecture/worldTFR.csv") %>%
    na.omit()

# In the lm() function, if you put a . after the ~ the function
# assumes to use all other columns
lmTFR <- lm(TFR ~ ., data = tfr)

# Values with a negative coefficient here will have some sort of negative
# correlation with TFR
summary(lmTFR)
```

2. Pick two variables from Q1 and use the package ggplot2 to plot them and TFR
   separately, where the two variables you choose should be on your x-axis, and
   TFR should be on the y-axis. Add appropriate labels. Compare the two plots
   and explain the differences.
```{r}
tfr <- read.csv("/Users/river/Documents/GitHub/RCamp2023/Day5/Lecture/worldTFR.csv") %>%
  na.omit()

ggplot(tfr, aes(x = LifeExpB, y = TFR)) +
  geom_smooth(method = "lm") +
  geom_point() +
  labs(y = "Total Fertility Rate", x = "Life Expectancy")

ggplot(tfr, aes(x = Pop1564Female, y = TFR)) +
  # geom_smooth(method = "lm") +
  geom_point() +
  labs(y = "Total Fertility Rate", x = "Pop1564Female")
```


3. Create a new dataframe named df1, such that the dataframe has two columns:
   Year and avg_TFR. The column Year should list the years with no duplicates,
   and the column TFR should store the average TFR of all countries during that
   specific year. Use the package ggplot2 to visualize the relationship between
   Year and avg_TFR. Describe what you see.
```{r}
df1 <- tfr %>%
  group_by(Year) %>%
  summarise(avg_TFR = mean(TFR, na.rm = TRUE))

ggplot(df1, aes(x = Year, y = avg_TFR)) +
  # geom_smooth(method = "lm") +
  geom_point() +
  labs(y = "Total Fertility Rate", x = "Years")
```

